<!DOCTYPE html>
<html lang="fr">
  <meta charset="UTF-8">
  <title>Chapitre 7 - Mod√®les et base de donn√©es (ORM)</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: #f4f4f4;
      color: #333;
    }
    header {
      background-color: #092e20;
      color: white;
      padding: 2rem;
      text-align: center;
    }
    main {
      max-width: 800px;
      margin: 2rem auto;
      padding: 2rem;
      background: white;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    h1, h2 {
      color: #092e20;
    }
    pre {
      background: #eee;
      padding: 1rem;
      border-radius: 5px;
      overflow-x: auto;
    }
    .btn {
      display: inline-block;
      margin-top: 2rem;
      padding: 0.8rem 1.5rem;
      background-color: #092e20;
      color: white;
      text-decoration: none;
      border-radius: 8px;
    }
    footer {
      text-align: center;
      padding: 2rem;
      font-size: 0.9rem;
    }
    a {
      color: #092e20;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header>
    <h1>Chapitre 7 : Mod√®les et base de donn√©es (ORM) üìö</h1>
    <p>Apprends √† manipuler les donn√©es avec l‚ÄôORM de Django pour interagir avec la base.</p>
  </header>

  <main>
    <h2>üîπ Qu‚Äôest-ce que l‚ÄôORM de Django ?</h2>
    <p>L‚ÄôORM (Object-Relational Mapping) de Django permet de repr√©senter les tables de la base de donn√©es comme des classes Python. Chaque mod√®le correspond √† une table, et chaque instance √† une ligne.</p>
    <p><strong>Avantages de l‚ÄôORM :</strong></p>
    <ul>
      <li>Syntaxe intuitive (ex. <code>Article.objects.all()</code>).</li>
      <li>Gestion des relations (ex. cl√©s √©trang√®res).</li>
      <li>Protection contre les injections SQL.</li>
    </ul>

    <h2>üîπ Exemple 1 : Cr√©er un mod√®le</h2>
    <p>Modifie <code>blog/models.py</code>:</p>
    <pre><code>
from django.db import models

class Article(models.Model):
    titre = models.CharField(max_length=255)
    contenu = models.TextField()
    date_creation = models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return self.titre
    </code></pre>
    <p>Cr√©e une migration:</p>
    <pre><code>
python manage.py makemigrations
    </code></pre>
    <p>Applique la migration:</p>
    <pre><code>
python manage.py migrate
    </code></pre>
    <p><strong>R√©sultat</strong>: Cr√©e une table <code>blog_article</code> avec les colonnes <code>titre</code>, <code>contenu</code>, et <code>date_creation</code>.</p>

    <h2>üîπ Exemple 2 : R√©cup√©rer des donn√©es</h2>
    <p>Modifie <code>blog/views.py</code>:</p>
    <pre><code>
from django.shortcuts import render
from .models import Article

def articles(request):
    articles = Article.objects.all()
    return render(request, 'blog/articles.html', {'articles': articles})
    </code></pre>
    <p>Modifie <code>blog/templates/blog/articles.html</code>:</p>
    <pre><code>
<h1>Articles</h1>
<ul>
{% for article in articles %}
    <li>{{ article.titre }} ({{ article.date_creation }})</li>
{% empty %}
    <li>Aucun article.</li>
{% endfor %}
</ul>
    </code></pre>
    <p><strong>R√©sultat</strong>: <code>/blog/articles/</code> affiche tous les articles.</p>

    <h2>üîπ Exemple 3 : Cr√©er un enregistrement</h2>
    <p>Ajoute une vue pour cr√©er un article:</p>
    <pre><code>
def ajouter_article(request):
    if request.method == 'POST':
        titre = request.POST['titre']
        contenu = request.POST['contenu']
        Article.objects.create(titre=titre, contenu=contenu)
        return redirect('articles')
    return render(request, 'blog/ajouter_article.html')
    </code></pre>
    <p>Cr√©e <code>blog/templates/blog/ajouter_article.html</code>:</p>
    <pre><code>
<form method="post">
    {% csrf_token %}
    <label>Titre :</label>
    <input type="text" name="titre">
    <label>Contenu :</label>
    <textarea name="contenu"></textarea>
    <button type="submit">Ajouter</button>
</form>
    </code></pre>
    <p>Modifie <code>blog/urls.py</code>:</p>
    <pre><code>
urlpatterns = [
    path('articles/', views.articles, name='articles'),
    path('articles/ajouter/', views.ajouter_article, name='ajouter_article'),
]
    </code></pre>
    <p><strong>R√©sultat</strong>: <code>/blog/articles/ajouter/</code> permet de cr√©er un article.</p>

    <h2>üîπ Exemple 4 : Requ√™tes avanc√©es</h2>
    <p>Modifie <code>articles</code> pour filtrer:</p>
    <pre><code>
def articles(request):
    articles = Article.objects.filter(titre__contains='test')
    return render(request, 'blog/articles.html', {'articles': articles})
    </code></pre>
    <p><strong>R√©sultat</strong>: N‚Äôaffiche que les articles contenant "test" dans le titre.</p>

    <h2>üîπ Erreurs courantes √† √©viter</h2>
    <ul>
      <li><strong>Migration non appliqu√©e</strong>: Ex√©cute <code>makemigrations</code> et <code>migrate</code>.</li>
      <li><strong>Mod√®le non import√©</strong>: V√©rifie <code>from .models import Article</code>.</li>
      <li><strong>CSRF manquant</strong>: Ajoute <code>{% csrf_token %}</code> dans les formulaires POST.</li>
    </ul>

    <h2>üìù Exercice</h2>
    <p>1. Cr√©e un mod√®le <code>Produit</code> dans <code>articles/models.py</code> avec <code>nom</code> et <code>prix</code>.<br>
    2. Cr√©e et applique les migrations.<br>
    3. Cr√©e une vue pour lister tous les produits.<br>
    4. Cr√©e un formulaire pour ajouter un produit.<br>
    5. Configure les URLs et teste la cr√©ation et l‚Äôaffichage.</p>

    <a href="django8.html" class="btn">‚û°Ô∏è Chapitre 8 : Formulaires et validation</a>
  </main>

  <footer>
    <p><a href="../index.html">‚Üê Retour au menu Django</a></p>
  </footer>
</body>
</html>
