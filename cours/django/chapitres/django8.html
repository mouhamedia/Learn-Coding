<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Chapitre 8 - Formulaires et validation</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: #f4f4f4;
      color: #333;
    }
    header {
      background-color: #092e20;
      color: white;
      padding: 2rem;
      text-align: center;
    }
    main {
      max-width: 800px;
      margin: 2rem auto;
      padding: 2rem;
      background: white;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    h1, h2 {
      color: #092e20;
    }
    pre {
      background: #eee;
      padding: 1rem;
      border-radius: 5px;
      overflow-x: auto;
    }
    .btn {
      display: inline-block;
      margin-top: 2rem;
      padding: 0.8rem 1.5rem;
      background-color: #092e20;
      color: white;
      text-decoration: none;
      border-radius: 8px;
    }
    footer {
      text-align: center;
      padding: 2rem;
      font-size: 0.9rem;
    }
    a {
      color: #092e20;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header>
    <h1>Chapitre 8 : Formulaires et validation üìù</h1>
    <p>Apprends √† cr√©er des formulaires et √† valider les donn√©es pour une application s√©curis√©e.</p>
  </header>

  <main>
    <h2>üîπ Pourquoi les formulaires et la validation ?</h2>
    <p>Les formulaires permettent aux utilisateurs d‚Äôenvoyer des donn√©es (ex. ajouter un article). La validation garantit que ces donn√©es sont correctes et s√©curis√©es avant traitement.</p>
    <p><strong>Fonctionnalit√©s de Django :</strong></p>
    <ul>
      <li>Formulaires automatis√©s avec <code>forms.ModelForm</code>.</li>
      <li>Validation int√©gr√©e (ex. <code>required</code>, <code>max_length</code>).</li>
      <li>Protection CSRF automatique.</li>
    </ul>

    <h2>üîπ Exemple 1 : Formulaire simple</h2>
    <p>Cr√©e <code>blog/forms.py</code>:</p>
    <pre><code>
from django import forms

class ArticleForm(forms.Form):
    titre = forms.CharField(max_length=255, required=True)
    contenu = forms.CharField(widget=forms.Textarea, required=False)
    </code></pre>
    <p>Modifie <code>blog/views.py</code>:</p>
    <pre><code>
from django.shortcuts import render, redirect
from .forms import ArticleForm

def ajouter_article(request):
    if request.method == 'POST':
        form = ArticleForm(request.POST)
        if form.is_valid():
            titre = form.cleaned_data['titre']
            contenu = form.cleaned_data['contenu']
            Article.objects.create(titre=titre, contenu=contenu)
            return redirect('articles')
    else:
        form = ArticleForm()
    return render(request, 'blog/ajouter_article.html', {'form': form})
    </code></pre>
    <p>Cr√©e <code>blog/templates/blog/ajouter_article.html</code>:</p>
    <pre><code>
<form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">Ajouter</button>
</form>
    </code></pre>
    <p><strong>R√©sultat</strong>: <code>/blog/articles/ajouter/</code> affiche un formulaire valid√©.</p>

    <h2>üîπ Exemple 2 : Formulaire bas√© sur un mod√®le</h2>
    <p>Modifie <code>blog/forms.py</code>:</p>
    <pre><code>
from django import forms
from .models import Article

class ArticleModelForm(forms.ModelForm):
    class Meta:
        model = Article
        fields = ['titre', 'contenu']
    </code></pre>
    <p>Modifie <code>blog/views.py</code>:</p>
    <pre><code>
def ajouter_article_model(request):
    if request.method == 'POST':
        form = ArticleModelForm(request.POST)
        if form.is_valid():
            form.save()
            return redirect('articles')
    else:
        form = ArticleModelForm()
    return render(request, 'blog/ajouter_article.html', {'form': form})
    </code></pre>
    <p>Modifie <code>blog/urls.py</code>:</p>
    <pre><code>
urlpatterns = [
    path('articles/ajouter-model/', views.ajouter_article_model, name='ajouter_article_model'),
]
    </code></pre>
    <p><strong>R√©sultat</strong>: Simplifie la cr√©ation d‚Äôarticles en utilisant le mod√®le.</p>

    <h2>üîπ Exemple 3 : Afficher les erreurs</h2>
    <p>Modifie <code>ajouter_article.html</code>:</p>
    <pre><code>
<form method="post">
    {% csrf_token %}
    {% if form.errors %}
        <ul>
        {% for field, errors in form.errors.items %}
            <li>{{ field }} : {{ errors|join:", " }}</li>
        {% endfor %}
        </ul>
    {% endif %}
    {{ form.as_p }}
    <button type="submit">Ajouter</button>
</form>
    </code></pre>
    <p><strong>R√©sultat</strong>: Affiche les erreurs de validation (ex. titre vide).</p>

    <h2>üîπ Exemple 4 : Validation personnalis√©e</h2>
    <p>Ajoute une r√®gle dans <code>ArticleForm</code>:</p>
    <pre><code>
def clean_titre(self):
    titre = self.cleaned_data['titre']
    if 'test' in titre.lower():
        raise forms.ValidationError("Le titre ne peut pas contenir 'test'.")
    return titre
    </code></pre>
    <p><strong>R√©sultat</strong>: Bloque les titres contenant "test".</p>

    <h2>üîπ Erreurs courantes √† √©viter</h2>
    <ul>
      <li><strong>CSRF manquant</strong>: Toujours inclure <code>{% csrf_token %}</code>.</li>
      <li><strong>Formulaire non valid√©</strong>: V√©rifie <code>form.is_valid()</code> avant de sauvegarder.</li>
      <li><strong>Champs manquants</strong>: D√©finis tous les champs n√©cessaires dans <code>ModelForm</code>.</li>
    </ul>

    <h2>üìù Exercice</h2>
    <p>1. Cr√©e un formulaire <code>ProduitForm</code> pour <code>nom</code> et <code>prix</code>.<br>
    2. Cr√©e une vue pour ajouter un produit avec validation.<br>
    3. Cr√©e un template avec affichage des erreurs.<br>
    4. Cr√©e un <code>ProduitModelForm</code> bas√© sur le mod√®le <code>Produit</code>.<br>
    5. Teste les deux formulaires.</p>

    <a href="django9.html" class="btn">‚û°Ô∏è Chapitre 9 : Administration Django</a>
  </main>

  <footer>
    <p><a href="../index.html">‚Üê Retour au menu Django</a></p>
  </footer>
</body>
</html>