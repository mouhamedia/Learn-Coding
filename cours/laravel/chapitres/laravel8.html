<!DOCTYPE html>
<html lang="fr">
  <meta charset="UTF-8">
  <title>Chapitre 8 - Formulaires et validation</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: #f4f4f4;
      color: #333;
    }
    header {
      background-color: #003049;
      color: white;
      padding: 2rem;
      text-align: center;
    }
    main {
      max-width: 800px;
      margin: 2rem auto;
      padding: 2rem;
      background: white;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    h1, h2 {
      color: #003049;
    }
    pre {
      background: #eee;
      padding: 1rem;
      border-radius: 5px;
      overflow-x: auto;
    }
    .btn {
      display: inline-block;
      margin-top: 2rem;
      padding: 0.8rem 1.5rem;
      background-color: #003049;
      color: white;
      text-decoration: none;
      border-radius: 8px;
    }
    footer {
      text-align: center;
      padding: 2rem;
      font-size: 0.9rem;
    }
    a {
      color: #003049;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header>
    <h1>Chapitre 8 : Formulaires et validation üìù</h1>
    <p>Apprends √† cr√©er des formulaires interactifs et √† valider les donn√©es avec Laravel.</p>
  </header>

  <main>
    <h2>üîπ Pourquoi valider les formulaires ?</h2>
    <p>Les formulaires permettent aux utilisateurs d‚Äôenvoyer des donn√©es (ex. : inscription, ajout d‚Äôun article). La validation garantit que ces donn√©es sont correctes et s√©curis√©es avant de les traiter ou de les enregistrer.</p>
    <p><strong>Fonctionnalit√©s de Laravel</strong> :</p>
    <ul>
      <li>Validation des donn√©es avec des r√®gles simples (ex. : requis, email valide).</li>
      <li>Affichage automatique des erreurs dans les vues.</li>
      <li>Protection CSRF int√©gr√©e pour s√©curiser les formulaires.</li>
    </ul>

    <h2>üîπ Exemple 1 : Cr√©er un formulaire</h2>
    <p>Cr√©e <code>resources/views/articles/creer.blade.php</code> pour ajouter un article :</p>
    <pre><code>
<form method="POST" action="/articles">
    @csrf
    <label for="titre">Titre :</label>
    <input type="text" name="titre" id="titre">
    @error('titre')
        <span style="color: red;">{{ $message }}</span>
    @enderror
    <label for="contenu">Contenu :</label>
    <textarea name="contenu" id="contenu"></textarea>
    @error('contenu')
        <span style="color: red;">{{ $message }}</span>
    @enderror
    <button type="submit">Cr√©er l‚Äôarticle</button>
</form>
    </code></pre>
    <p><strong>Explication</strong> :</p>
    <ul>
      <li><code>@csrf</code> ajoute un token CSRF pour s√©curiser le formulaire.</li>
      <li><code>@error</code> affiche les messages d‚Äôerreur pour chaque champ.</li>
      <li><code>action="/articles"</code> envoie les donn√©es √† la route <code>/articles</code>.</li>
    </ul>
    <p>Cr√©e une route pour afficher le formulaire :</p>
    <pre><code>
Route::get('/articles/creer', function () {
    return view('articles.creer');
});
    </code></pre>

    <h2>üîπ Exemple 2 : Valider les donn√©es</h2>
    <p>Cr√©e un contr√¥leur pour traiter le formulaire :</p>
    <pre><code>
php artisan make:controller ArticleController
    </code></pre>
    <p>Modifie <code>app/Http/Controllers/ArticleController.php</code> :</p>
    <pre><code>
namespace App\Http\Controllers;

use App\Models\Article;
use Illuminate\Http\Request;

class ArticleController extends Controller
{
    public function store(Request $request)
    {
        $validated = $request->validate([
            'titre' => 'required|max:255',
            'contenu' => 'required'
        ]);

        Article::create($validated);
        return redirect('/articles')->with('success', 'Article cr√©√© !');
    }
}
    </code></pre>
    <p>Ajoute la route :</p>
    <pre><code>
Route::post('/articles', [ArticleController::class, 'store']);
    </code></pre>
    <p><strong>Explication</strong> :</p>
    <ul>
      <li><code>validate</code> v√©rifie que <code>titre</code> est requis et ne d√©passe pas 255 caract√®res, et que <code>contenu</code> est requis.</li>
      <li><code>Article::create</code> enregistre les donn√©es valid√©es.</li>
      <li><code>with('success', ...)</code> ajoute un message flash √† la redirection.</li>
    </ul>
    <p><strong>R√©sultat</strong> : Si les donn√©es sont valides, un article est cr√©√© ; sinon, les erreurs s‚Äôaffichent dans le formulaire.</p>

    <h2>üîπ Exemple 3 : Afficher un message de succ√®s</h2>
    <p>Modifie <code>articles/index.blade.php</code> pour afficher le message flash :</p>
    <pre><code>
@if(session('success'))
    <p style="color: green;">{{ session('success') }}</p>
@endif
<h1>Articles</h1>
<ul>
    @foreach($articles as $article)
        <li>{{ $article->titre }}</li>
    @endforeach
</ul>
    </code></pre>
    <p><strong>R√©sultat</strong> : Apr√®s avoir cr√©√© un article, la page <code>/articles</code> affiche "Article cr√©√© !".</p>

    <h2>üîπ Exemple 4 : Validation personnalis√©e</h2>
    <p>Ajoute une r√®gle pour v√©rifier que le titre est unique :</p>
    <pre><code>
$validated = $request->validate([
    'titre' => 'required|max:255|unique:articles,titre',
    'contenu' => 'required|min:10'
]);
    </code></pre>
    <p><strong>Explication</strong> :</p>
    <ul>
      <li><code>unique:articles,titre</code> v√©rifie que le titre n‚Äôexiste pas d√©j√† dans la table <code>articles</code>.</li>
      <li><code>min:10</code> exige que <code>contenu</code> ait au moins 10 caract√®res.</li>
    </ul>

    <h2>üîπ Erreurs courantes et solutions</h2>
    <ul>
      <li><strong>"CSRF token mismatch"</strong> : Ajoute <code>@csrf</code> dans le formulaire.</li>
      <li><strong>"Validation errors not showing"</strong> : V√©rifie que <code>@error</code> est pr√©sent pour chaque champ.</li>
      <li><strong>"Mass assignment error"</strong> : Ajoute <code>protected $fillable = ['titre', 'contenu'];</code> dans le mod√®le.</li>
    </ul>

    <h2>üìù Exercice</h2>
    <p>Cr√©e un formulaire pour ajouter une t√¢che :</p>
    <ol>
      <li>Cr√©e une vue <code>taches/creer.blade.php</code> avec un formulaire pour <code>titre</code> (text) et <code>description</code> (textarea).</li>
      <li>Ajoute une route GET <code>/taches/creer</code> pour afficher le formulaire.</li>
      <li>Cr√©e une route POST <code>/taches</code> et une m√©thode dans <code>TacheController</code> pour valider (<code>titre</code> requis, <code>description</code> facultative) et enregistrer la t√¢che.</li>
      <li>Affiche les erreurs dans le formulaire et un message de succ√®s apr√®s cr√©ation.</li>
      <li>Teste le formulaire en soumettant des donn√©es valides et invalides.</li>
    </ol>

    <a href="laravel9.html" class="btn">‚û°Ô∏è Chapitre 9 : Middleware</a>
  </main>

  <footer>
    <p><a href="../index.html">‚Üê Retour au menu Laravel</a></p>
  </footer>
</body>
</html>
