<!DOCTYPE html>
<html lang="fr">
  <meta charset="UTF-8">
  <title>Chapitre 6 - Mod√®les et base de donn√©es (Eloquent)</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: #f4f4f4;
      color: #333;
    }
    header {
      background-color: #003049;
      color: white;
      padding: 2rem;
      text-align: center;
    }
    main {
      max-width: 800px;
      margin: 2rem auto;
      padding: 2rem;
      background: white;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    h1, h2 {
      color: #003049;
    }
    pre {
      background: #eee;
      padding: 1rem;
      border-radius: 5px;
      overflow-x: auto;
    }
    .btn {
      display: inline-block;
      margin-top: 2rem;
      padding: 0.8rem 1.5rem;
      background-color: #003049;
      color: white;
      text-decoration: none;
      border-radius: 8px;
    }
    footer {
      text-align: center;
      padding: 2rem;
      font-size: 0.9rem;
    }
    a {
      color: #003049;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header>
    <h1>Chapitre 6 : Mod√®les et base de donn√©es (Eloquent) üìö</h1>
    <p>Apprends √† g√©rer les donn√©es avec Eloquent, l‚ÄôORM de Laravel, pour interagir avec la base de donn√©es.</p>
  </header>

  <main>
    <h2>üîπ Qu‚Äôest-ce qu‚ÄôEloquent ?</h2>
    <p>Eloquent est l‚ÄôORM (Object-Relational Mapping) de Laravel. Il repr√©sente les tables de la base de donn√©es comme des classes PHP, et les lignes comme des objets, rendant les requ√™tes SQL intuitives.</p>
    <p><strong>Avantages</strong> :</p>
    <ul>
      <li>Syntaxe simple : <code>Article::all()</code> remplace <code>SELECT * FROM articles</code>.</li>
      <li>Protection contre les injections SQL.</li>
      <li>Relations entre tables (ex. : un article a plusieurs commentaires).</li>
    </ul>
    <p><strong>Exemple</strong> : Un mod√®le <code>Article</code> peut repr√©senter la table <code>articles</code>, avec des m√©thodes pour cr√©er, lire, mettre √† jour, ou supprimer des enregistrements.</p>

    <h2>üîπ Cr√©er un mod√®le</h2>
    <p>Utilise Artisan pour g√©n√©rer un mod√®le avec une migration :</p>
    <pre><code>
php artisan make:model Article -m
    </code></pre>
    <p><strong>R√©sultat</strong> :</p>
    <ul>
      <li>Cr√©e <code>app/Models/Article.php</code> :</li>
      <pre><code>
namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Article extends Model
{
    //
}
      </code></pre>
      <li>Cr√©e une migration dans <code>database/migrations/</code> (ex. : <code>2025_05_24_create_articles_table.php</code>).</li>
    </ul>
    <p>Modifie la migration pour d√©finir la table :</p>
    <pre><code>
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

class CreateArticlesTable extends Migration
{
    public function up()
    {
        Schema::create('articles', function (Blueprint $table) {
            $table->id();
            $table->string('titre');
            $table->text('contenu');
            $table->timestamps();
        });
    }

    public function down()
    {
        Schema::dropIfExists('articles');
    }
}
    </code></pre>
    <p>Ex√©cute la migration :</p>
    <pre><code>
php artisan migrate
    </code></pre>
    <p><strong>R√©sultat</strong> : Cr√©e la table <code>articles</code> avec les colonnes <code>id</code>, <code>titre</code>, <code>contenu</code>, <code>created_at</code>, et <code>updated_at</code>.</p>

    <h2>üîπ Op√©rations CRUD avec Eloquent</h2>
    <p>Eloquent simplifie les op√©rations CRUD (Create, Read, Update, Delete).</p>
    <p><strong>Exemple 1 : Cr√©er un enregistrement</strong></p>
    <p>Dans un contr√¥leur :</p>
    <pre><code>
namespace App\Http\Controllers;

use App\Models\Article;

class ArticleController extends Controller
{
    public function store()
    {
        Article::create([
            'titre' => 'Mon premier article',
            'contenu' => 'Ceci est un test.'
        ]);
        return 'Article cr√©√© !';
    }
}
    </code></pre>
    <p>Ajoute au mod√®le <code>Article.php</code> :</p>
    <pre><code>
protected $fillable = ['titre', 'contenu'];
    </code></pre>
    <p><strong>R√©sultat</strong> : Cr√©e un nouvel article dans la table.</p>
    <p><strong>Exemple 2 : Lire des enregistrements</strong></p>
    <pre><code>
public function index()
{
    $articles = Article::all();
    return view('articles.index', ['articles' => $articles]);
}
    </code></pre>
    <p>Cr√©e <code>resources/views/articles/index.blade.php</code> :</p>
    <pre><code>
<h1>Articles</h1>
@foreach($articles as $article)
    <div>
        <h2>{{ $article->titre }}</h2>
        <p>{{ $article->contenu }}</p>
    </div>
@endforeach
    </code></pre>
    <p><strong>R√©sultat</strong> : Affiche tous les articles.</p>
    <p><strong>Exemple 3 : Mettre √† jour</strong></p>
    <pre><code>
public function update($id)
{
    $article = Article::find($id);
    $article->titre = 'Nouveau titre';
    $article->save();
    return 'Article mis √† jour !';
}
    </code></pre>
    <p><strong>R√©sultat</strong> : Met √† jour l‚Äôarticle avec l‚ÄôID sp√©cifi√©.</p>
    <p><strong>Exemple 4 : Supprimer</strong></p>
    <pre><code>
public function destroy($id)
{
    Article::destroy($id);
    return 'Article supprim√© !';
}
    </code></pre>
    <p><strong>R√©sultat</strong> : Supprime l‚Äôarticle.</p>

    <h2>üîπ Erreurs courantes √† √©viter</h2>
    <ul>
      <li><strong>Mass Assignment</strong> : D√©finis <code>$fillable</code> dans le mod√®le pour autoriser les champs √† remplir.</li>
      <li><strong>Migration non ex√©cut√©e</strong> : Toujours ex√©cuter <code>php artisan migrate</code> avant d‚Äôutiliser un mod√®le.</li>
      <li><strong>ID introuvable</strong> : V√©rifie que <code>Article::find($id)</code> retourne un r√©sultat avant de modifier.</li>
      <li><strong>Connexion √† la base</strong> : Assure-toi que <code>.env</code> est correctement configur√©.</li>
    </ul>

    <h2>üìù Exercice</h2>
    <p>1. Cr√©e un mod√®le <code>Tache</code> avec une migration pour une table <code>taches</code> (colonnes : <code>id</code>, <code>titre</code>, <code>description</code>, <code>timestamps</code>).<br>
    2. Ex√©cute la migration.<br>
    3. Cr√©e un contr√¥leur <code>TacheController</code> avec une m√©thode <code>index</code> qui affiche toutes les t√¢ches dans une vue <code>taches/index.blade.php</code>.<br>
    4. Ajoute une m√©thode <code>store</code> pour cr√©er une t√¢che avec des donn√©es fixes (ex. : <code>titre = 'T√¢che 1'</code>).<br>
    5. Teste <code>/taches</code> et v√©rifie que la t√¢che est cr√©√©e.<br>
    6. (Bonus) Ajoute une m√©thode <code>show</code> pour afficher une t√¢che par son ID.</p>

    <a href="laravel7.html" class="btn">‚û°Ô∏è Chapitre 7 : Les migrations</a>
  </main>

  <footer>
    <p><a href="../index.html">‚Üê Retour au menu Laravel</a></p>
  </footer>
</body>
</html>
