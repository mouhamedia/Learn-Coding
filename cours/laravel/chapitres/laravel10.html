<!DOCTYPE html>
<html lang="fr">
  <meta charset="UTF-8">
  <title>Chapitre 10 - Authentification et s√©curit√©</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: #f4f4f4;
      color: #333;
    }
    header {
      background-color: #003049;
      color: white;
      padding: 2rem;
      text-align: center;
    }
    main {
      max-width: 800px;
      margin: 2rem auto;
      padding: 2rem;
      background: white;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    h1, h2 {
      color: #003049;
    }
    pre {
      background: #eee;
      padding: 1rem;
      border-radius: 5px;
      overflow-x: auto;
    }
    .btn {
      display: inline-block;
      margin-top: 2rem;
      padding: 0.8rem 1.5rem;
      background-color: #003049;
      color: white;
      text-decoration: none;
      border-radius: 8px;
    }
    footer {
      text-align: center;
      padding: 2rem;
      font-size: 0.9rem;
    }
    a {
      color: #003049;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
  </style>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3429663628581948" crossorigin="anonymous"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3429663628581948" crossorigin="anonymous"></script></head>
<body>
  <header>
    <h1>Chapitre 10 : Authentification et s√©curit√© üîê</h1>
    <p>Apprends √† impl√©menter un syst√®me d‚Äôauthentification et √† s√©curiser ton application Laravel contre les attaques courantes.</p>
  </header>

  <main>
    <h2>üîπ Pourquoi l‚Äôauthentification et la s√©curit√© ?</h2>
    <p>L‚Äôauthentification permet de v√©rifier l‚Äôidentit√© des utilisateurs (connexion, inscription, d√©connexion) et de restreindre l‚Äôacc√®s √† certaines parties de l‚Äôapplication. La s√©curit√© prot√®ge contre des menaces comme les attaques CSRF, XSS, ou les injections SQL, garantissant la fiabilit√© et la confidentialit√© des donn√©es.</p>
    <p><strong>Fonctionnalit√©s cl√©s de Laravel :</strong></p>
    <ul>
      <li><strong>Authentification int√©gr√©e</strong> : Packages comme <code>laravel/breeze</code> ou <code>laravel/ui</code> pour une mise en place rapide.</li>
      <li><strong>Middleware <code>auth</code></strong> : Restreint l‚Äôacc√®s aux utilisateurs connect√©s.</li>
      <li><strong>Protection CSRF</strong> : Token automatique pour s√©curiser les formulaires.</li>
      <li><strong>√âchappement XSS</strong> : Blade √©chappe les donn√©es par d√©faut.</li>
      <li><strong>Hachage des mots de passe</strong> : Stockage s√©curis√© avec <code>bcrypt</code>.</li>
    </ul>

    <h2>üîπ Exemple 1 : Installer Laravel Breeze</h2>
    <p><code>laravel/breeze</code> est un package simple pour ajouter l‚Äôauthentification (inscription, connexion, r√©initialisation de mot de passe). Installe-le dans ton projet :</p>
    <pre><code>
composer require laravel/breeze --dev
php artisan breeze:install
npm install && npm run dev
php artisan migrate
    </code></pre>
    <p><strong>Explication</strong> :</p>
    <ul>
      <li><code>composer require laravel/breeze</code> : Ajoute Breeze comme d√©pendance.</li>
      <li><code>breeze:install</code> : Configure les routes, vues, contr√¥leurs, et migrations pour l‚Äôauthentification.</li>
      <li><code>npm install && npm run dev</code> : Compile les assets CSS et JavaScript (ex. Tailwind CSS).</li>
      <li><code>php artisan migrate</code> : Cr√©e la table <code>users</code> pour stocker les utilisateurs.</li>
    </ul>
    <p><strong>R√©sultat</strong> : Ton application inclut maintenant des pages pour <code>/login</code>, <code>/register</code>, <code>/dashboard</code>, et <code>/logout</code>. Acc√®de √† <code>http://localhost:8000/register</code> pour tester l‚Äôinscription.</p>

    <h2>üîπ Exemple 2 : Prot√©ger une route avec le middleware auth</h2>
    <p>Cr√©e une route prot√©g√©e qui n‚Äôest accessible qu‚Äôaux utilisateurs connect√©s. Modifie <code>routes/web.php</code> :</p>
    <pre><code>
use Illuminate\Support\Facades\Route;

Route::get('/dashboard', function () {
    return view('dashboard');
})->middleware('auth');
    </code></pre>
    <p>Cr√©e <code>resources/views/dashboard.blade.php</code> :</p>
    <pre><code>
<h1>Tableau de bord</h1>
<p>Bienvenue, {{ auth()->user()->name }} !</p>
<a href="{{ route('logout') }}">Se d√©connecter</a>
    </code></pre>
    <p><strong>Explication</strong> :</p>
    <ul>
      <li><code>middleware('auth')</code> : V√©rifie si un utilisateur est connect√©. Sinon, redirige vers <code>/login</code>.</li>
      <li><code>auth()->user()->name</code> : R√©cup√®re le nom de l‚Äôutilisateur connect√©.</li>
      <li><code>route('logout')</code> : Utilise une route nomm√©e pour la d√©connexion (fournie par Breeze).</li>
    </ul>
    <p><strong>R√©sultat</strong> : Acc√®de √† <code>/dashboard</code> apr√®s connexion pour voir un message personnalis√©. Sans connexion, tu es redirig√© vers la page de login.</p>

    <h2>üîπ Exemple 3 : Formulaire de connexion personnalis√©</h2>
    <p>Breeze fournit des vues par d√©faut, mais tu peux les personnaliser. Modifie <code>resources/views/auth/login.blade.php</code> pour un formulaire simplifi√© :</p>
    <pre><code>
<x-guest-layout>
    <form method="POST" action="{{ route('login') }}">
        @csrf
        <div>
            <label for="email">Email</label>
            <input id="email" type="email" name="email" value="{{ old('email') }}" required>
            @error('email')
                <span style="color: red;">{{ $message }}</span>
            @enderror
        </div>
        <div>
            <label for="password">Mot de passe</label>
            <input id="password" type="password" name="password" required>
            @error('password')
                <span style="color: red;">{{ $message }}</span>
            @enderror
        </div>
        <button type="submit">Se connecter</button>
    </form>
</x-guest-layout>
    </code></pre>
    <p><strong>Explication</strong> :</p>
    <ul>
      <li><code>@csrf</code> : Ajoute un token pour s√©curiser le formulaire.</li>
      <li><code>old('email')</code> : Restaure l‚Äôemail saisi en cas d‚Äôerreur.</li>
      <li><code>@error</code> : Affiche les messages d‚Äôerreur (ex. "Email invalide").</li>
      <li><code>x-guest-layout</code> : Composant Blade fourni par Breeze pour une mise en page coh√©rente.</li>
    </ul>
    <p><strong>R√©sultat</strong> : La page <code>/login</code> affiche un formulaire stylis√©. Une tentative avec des identifiants incorrects montre des erreurs.</p>

    <h2>üîπ Exemple 4 : Afficher les informations de l‚Äôutilisateur</h2>
    <p>Cr√©e une route pour afficher le profil de l‚Äôutilisateur connect√©. Ajoute dans <code>routes/web.php</code> :</p>
    <pre><code>
Route::get('/profil', function () {
    return view('profil', ['user' => auth()->user()]);
})->middleware('auth');
    </code></pre>
    <p>Cr√©e <code>resources/views/profil.blade.php</code> :</p>
    <pre><code>
<h1>Mon profil</h1>
<p>Nom : {{ $user->name }}</p>
<p>Email : {{ $user->email }}</p>
<p>Inscrit le : {{ $user->created_at->format('d/m/Y') }}</p>
    </code></pre>
    <p><strong>Explication</strong> :</p>
    <ul>
      <li><code>auth()->user()</code> : R√©cup√®re l‚Äôobjet utilisateur connect√©.</li>
      <li><code>created_at->format</code> : Formate la date d‚Äôinscription.</li>
      <li><code>middleware('auth')</code> : Garantit que seul l‚Äôutilisateur connect√© voit son profil.</li>
    </ul>
    <p><strong>R√©sultat</strong> : <code>/profil</code> affiche les d√©tails de l‚Äôutilisateur (nom, email, date d‚Äôinscription).</p>

    <h2>üîπ Exemple 5 : S√©curiser les formulaires contre CSRF</h2>
    <p>Laravel prot√®ge automatiquement les formulaires avec un token CSRF. Voici un exemple de formulaire s√©curis√© pour mettre √† jour le nom de l‚Äôutilisateur :</p>
    <p>Cr√©e <code>resources/views/profil/edit.blade.php</code> :</p>
    <pre><code>
<h1>Modifier mon profil</h1>
<form method="POST" action="/profil/update">
    @csrf
    @method('PATCH')
    <label>Nouveau nom :</label>
    <input type="text" name="name" value="{{ auth()->user()->name }}">
    @error('name')
        <span style="color: red;">{{ $message }}</span>
    @enderror
    <button type="submit">Mettre √† jour</button>
</form>
    </code></pre>
    <p>Ajoute une route et un contr√¥leur :</p>
    <pre><code>
php artisan make:controller ProfilController
    </code></pre>
    <p>Modifie <code>app/Http/Controllers/ProfilController.php</code> :</p>
    <pre><code>
namespace App\Http\Controllers;

use Illuminate\Http\Request;

class ProfilController extends Controller
{
    public function edit()
    {
        return view('profil.edit');
    }

    public function update(Request $request)
    {
        $validated = $request->validate([
            'name' => 'required|max:255',
        ]);

        auth()->user()->update($validated);
        return redirect('/profil')->with('success', 'Profil mis √† jour !');
    }
}
    </code></pre>
    <p>Ajoute les routes dans <code>routes/web.php</code> :</p>
    <pre><code>
Route::get('/profil/edit', [App\Http\Controllers\ProfilController::class, 'edit'])->middleware('auth');
Route::patch('/profil/update', [App\Http\Controllers\ProfilController::class, 'update'])->middleware('auth');
    </code></pre>
    <p><strong>Explication</strong> :</p>
    <ul>
      <li><code>@csrf</code> : Prot√®ge contre les attaques CSRF.</li>
      <li><code>@method('PATCH')</code> : Simule une requ√™te PATCH pour la mise √† jour.</li>
      <li><code>with('success')</code> : Affiche un message flash apr√®s la mise √† jour.</li>
    </ul>
    <p><strong>R√©sultat</strong> : L‚Äôutilisateur peut modifier son nom √† <code>/profil/edit</code>, et le changement est s√©curis√©.</p>

    <h2>üîπ Mesures de s√©curit√© int√©gr√©es</h2>
    <p>Laravel offre plusieurs protections par d√©faut :</p>
    <ul>
      <li><strong>CSRF</strong> : Tous les formulaires POST, PUT, PATCH, et DELETE n√©cessitent un token <code>@csrf</code>.</li>
      <li><strong>XSS</strong> : Blade √©chappe les donn√©es avec <code>{{ }}</code> pour √©viter l‚Äôex√©cution de scripts malveillants.</li>
      <li><strong>Injection SQL</strong> : Eloquent utilise des requ√™tes pr√©par√©es pour s√©curiser les interactions avec la base.</li>
      <li><strong>Hachage des mots de passe</strong> : Les mots de passe sont hach√©s avec <code>bcrypt</code> avant stockage.</li>
    </ul>
    <p><strong>Exemple de hachage</strong> : Dans <code>app/Models/User.php</code>, Laravel g√®re automatiquement le hachage :</p>
    <pre><code>
// Lors de l'inscription
$user = User::create([
    'name' => $request->name,
    'email' => $request->email,
    'password' => bcrypt($request->password),
]);
    </code></pre>
    <p><strong>R√©sultat</strong> : Le mot de passe est stock√© de mani√®re s√©curis√©e dans la base.</p>

    <h2>üîπ Erreurs courantes √† √©viter</h2>
    <ul>
      <li><strong>Oubli de <code>@csrf</code></strong> : Les formulaires POST √©choueront sans token CSRF.</li>
      <li><strong>Assets non compil√©s</strong> : Ex√©cute <code>npm run dev</code> apr√®s <code>breeze:install</code> pour √©viter des erreurs de style.</li>
      <li><strong>Migrations manquantes</strong> : V√©rifie que <code>php artisan migrate</code> a cr√©√© la table <code>users</code>.</li>
      <li><strong>Acc√®s non autoris√©</strong> : Toujours utiliser <code>middleware('auth')</code> pour les routes sensibles.</li>
    </ul>

    <h2>üìù Exercice</h2>
    <p>1. Installe <code>laravel/breeze</code> dans un projet Laravel et ex√©cute les commandes pour configurer l‚Äôauthentification.<br>
    2. Teste l‚Äôinscription et la connexion via <code>/register</code> et <code>/login</code>.<br>
    3. Cr√©e une route prot√©g√©e <code>/mon-profil</code> qui affiche le nom, l‚Äôemail, et la date d‚Äôinscription de l‚Äôutilisateur connect√©.<br>
    4. Cr√©e un formulaire s√©curis√© √† <code>/mon-profil/edit</code> pour permettre √† l‚Äôutilisateur de modifier son nom.<br>
    5. Ajoute un message flash pour confirmer la mise √† jour du profil.<br>
    6. V√©rifie que les routes prot√©g√©es redirigent vers <code>/login</code> si l‚Äôutilisateur n‚Äôest pas connect√©.</p>

    <a href="../index.html" class="btn">‚Ü©Ô∏è Retour au sommaire</a>
  </main>

  <footer>
    <p><a href="../index.html">‚Üê Retour au menu Laravel</a></p>
  </footer>
<script src="/adsense.js"></script>
</body>
</html>



